package legend.admin.handlers;


import java.sql.*;
import java.text.SimpleDateFormat;

import com.magbel.util.DataConnect;

public class VendorHandler {
    Connection con = null;
    Statement stmt = null;
    PreparedStatement ps = null;
    ResultSet rs = null;
    DataConnect dc;
    SimpleDateFormat sdf;
    final String space = "  ";
    final String comma = ",";
    java.util.Date date;
    com.magbel.util.DatetimeFormat df;
    public VendorHandler() {

        sdf = new SimpleDateFormat("dd-MM-yyyy");
        df = new com.magbel.util.DatetimeFormat();
        System.out.println("USING_ " + this.getClass().getName());
    }

    public java.util.ArrayList getAllVendors() {
        java.util.ArrayList _list = new java.util.ArrayList();
        legend.admin.objects.Vendor vendor = null;
        String query = "SELECT Vendor_ID,Vendor_Code,Vendor_Name"
                       + ",Contact_Person,Contact_Address"
                       + ",Vendor_Phone ,Vendor_fax,Vendor_email"
                       + ",Vendor_State ,Acquisition_Vendor,Maintenance_Vendor"
                       + ",account_number ,Vendor_Status,User_ID"
                       + ",Create_date ,account_type,vendor_province "
                       + " FROM am_ad_vendor";

        Connection c = null;
        ResultSet rs = null;
        Statement s = null;

        try {
            c = getConnection();
            s = c.createStatement();
            rs = s.executeQuery(query);
            while (rs.next()) {
                String vendorId = rs.getString("Vendor_ID");
                String vendorCode = rs.getString("Vendor_Code");
                String vendorName = rs.getString("Vendor_Name");
                String contactPerson = rs.getString("Contact_Person");
                String contactAddress = rs.getString("Contact_Address");
                String vendorPhone = rs.getString("Vendor_Phone");
                String vendorFax = rs.getString("Vendor_fax");
                String vendorEmail = rs.getString("Vendor_email");
                String vendorState = rs.getString("Vendor_State");
                String aquisitionVendor = rs.getString("Acquisition_Vendor");
                String maintenanceVendor = rs.getString("Maintenance_Vendor");
                String accountNumber = rs.getString("account_number");
                String vendorStatus = rs.getString("Vendor_Status");
                String userId = rs.getString("User_ID");
                String createdate = sdf.format(rs.getDate("Create_date"));
                String accountType = rs.getString("account_type");
                String vendorProvince = rs.getString("vendor_province");
                vendor = new legend.admin.objects.Vendor();
                vendor.setVendorId(vendorId);
				vendor.setVendorCode(vendorCode);
				vendor.setVendorName(vendorName);
				vendor.setContactPerson(contactPerson);
				vendor.setContactAddress(contactAddress);
				vendor.setVendorPhone(vendorPhone);
				vendor.setVendorFax(vendorFax);
				vendor.setVendorEmail(vendorEmail);
				vendor.setVendorState(vendorState);
				vendor.setAquisitionVendor(aquisitionVendor);
				vendor.setMaintenanceVendor(maintenanceVendor);
				vendor.setAccountNumber(accountNumber);
				vendor.setVendorStatus(vendorStatus);
				vendor.setUserId(userId);
				vendor.setCreatedate(createdate);
				vendor.setAccountType(accountType);
				vendor.setVendorProvince(vendorProvince);

                _list.add(vendor);
            }

        } catch (Exception e) {
            e.printStackTrace();
        }

        finally {
            closeConnection(c, s, rs);
        }
        return _list;

    }

    public java.util.ArrayList getVendorByQuery(String filter) {
        java.util.ArrayList _list = new java.util.ArrayList();
        legend.admin.objects.Vendor vendor = null;
        String query = "SELECT Vendor_ID,Vendor_Code,Vendor_Name"
                       + ",Contact_Person,Contact_Address"
                       + ",Vendor_Phone ,Vendor_fax,Vendor_email"
                       + ",Vendor_State ,Acquisition_Vendor,Maintenance_Vendor"
                       + ",account_number ,Vendor_Status,User_ID"
                       + ",Create_date ,account_type,vendor_province "
                       + " FROM am_ad_vendor WHERE Vendor_ID IS NOT NULL ";


        query = query + filter;
        Connection c = null;
        ResultSet rs = null;
        Statement s = null;

        try {
            c = getConnection();
            s = c.createStatement();
            rs = s.executeQuery(query);
            while (rs.next()) {
                String vendorId = rs.getString("Vendor_ID");
                String vendorCode = rs.getString("Vendor_Code");
                String vendorName = rs.getString("Vendor_Name");
                String contactPerson = rs.getString("Contact_Person");
                String contactAddress = rs.getString("Contact_Address");
                String vendorPhone = rs.getString("Vendor_Phone");
                String vendorFax = rs.getString("Vendor_fax");
                String vendorEmail = rs.getString("Vendor_email");
                String vendorState = rs.getString("Vendor_State");
                String aquisitionVendor = rs.getString("Acquisition_Vendor");
                String maintenanceVendor = rs.getString("Maintenance_Vendor");
                String accountNumber = rs.getString("account_number");
                String vendorStatus = rs.getString("Vendor_Status");
                String userId = rs.getString("User_ID");
                String createdate = sdf.format(rs.getDate("Create_date"));
                String accountType = rs.getString("account_type");
                String vendorProvince = rs.getString("vendor_province");
                vendor = new legend.admin.objects.Vendor();
                vendor.setVendorId(vendorId);
				vendor.setVendorCode(vendorCode);
				vendor.setVendorName(vendorName);
				vendor.setContactPerson(contactPerson);
				vendor.setContactAddress(contactAddress);
				vendor.setVendorPhone(vendorPhone);
				vendor.setVendorFax(vendorFax);
				vendor.setVendorEmail(vendorEmail);
				vendor.setVendorState(vendorState);
				vendor.setAquisitionVendor(aquisitionVendor);
				vendor.setMaintenanceVendor(maintenanceVendor);
				vendor.setAccountNumber(accountNumber);
				vendor.setVendorStatus(vendorStatus);
				vendor.setUserId(userId);
				vendor.setCreatedate(createdate);
				vendor.setAccountType(accountType);
				vendor.setVendorProvince(vendorProvince);
                _list.add(vendor);
            }

        } catch (Exception e) {
            e.printStackTrace();
        }

        finally {
            closeConnection(c, s, rs);
        }
        return _list;

    }



    public legend.admin.objects.Vendor getVendorByVendorID(String vendid) {
        legend.admin.objects.Vendor vendor = null;
        String query = "SELECT Vendor_ID,Vendor_Code,Vendor_Name"
                       + ",Contact_Person,Contact_Address"
                       + ",Vendor_Phone ,Vendor_fax,Vendor_email"
                       + ",Vendor_State ,Acquisition_Vendor,Maintenance_Vendor"
                       + ",account_number ,Vendor_Status,User_ID"
                       + ",Create_date ,account_type,vendor_province "
                       + " FROM am_ad_vendor WHERE Vendor_ID=" + vendid;

        Connection c = null;
        ResultSet rs = null;
        Statement s = null;

        try {
            c = getConnection();
            s = c.createStatement();
            rs = s.executeQuery(query);
            while (rs.next()) {
                String vendorId = rs.getString("Vendor_ID");
                String vendorCode = rs.getString("Vendor_Code");
                String vendorName = rs.getString("Vendor_Name");
                String contactPerson = rs.getString("Contact_Person");
                String contactAddress = rs.getString("Contact_Address");
                String vendorPhone = rs.getString("Vendor_Phone");
                String vendorFax = rs.getString("Vendor_fax");
                String vendorEmail = rs.getString("Vendor_email");
                String vendorState = rs.getString("Vendor_State");
                String aquisitionVendor = rs.getString("Acquisition_Vendor");
                String maintenanceVendor = rs.getString("Maintenance_Vendor");
                String accountNumber = rs.getString("account_number");
                String vendorStatus = rs.getString("Vendor_Status");
                String userId = rs.getString("User_ID");
                String createdate = sdf.format(rs.getDate("Create_date"));
                String accountType = rs.getString("account_type");
                String vendorProvince = rs.getString("vendor_province");
                vendor = new legend.admin.objects.Vendor();
                vendor.setVendorId(vendorId);
				vendor.setVendorCode(vendorCode);
				vendor.setVendorName(vendorName);
				vendor.setContactPerson(contactPerson);
				vendor.setContactAddress(contactAddress);
				vendor.setVendorPhone(vendorPhone);
				vendor.setVendorFax(vendorFax);
				vendor.setVendorEmail(vendorEmail);
				vendor.setVendorState(vendorState);
				vendor.setAquisitionVendor(aquisitionVendor);
				vendor.setMaintenanceVendor(maintenanceVendor);
				vendor.setAccountNumber(accountNumber);
				vendor.setVendorStatus(vendorStatus);
				vendor.setUserId(userId);
				vendor.setCreatedate(createdate);
				vendor.setAccountType(accountType);
				vendor.setVendorProvince(vendorProvince);

            }

        } catch (Exception e) {
            e.printStackTrace();
        }

        finally {
            closeConnection(c, s, rs);
        }
        return vendor;

    }


    public legend.admin.objects.Vendor getVendorByVendorCode(String vendcode) {
        legend.admin.objects.Vendor vendor = null;
        String query = "SELECT Vendor_ID,Vendor_Code,Vendor_Name"
                       + ",Contact_Person,Contact_Address"
                       + ",Vendor_Phone ,Vendor_fax,Vendor_email"
                       + ",Vendor_State ,Acquisition_Vendor,Maintenance_Vendor"
                       + ",account_number ,Vendor_Status,User_ID"
                       + ",Create_date ,account_type,vendor_province "
                       + " FROM am_ad_vendor WHERE Vendor_Code=" + vendcode;


        Connection c = null;
        ResultSet rs = null;
        Statement s = null;

        try {
            c = getConnection();
            s = c.createStatement();
            rs = s.executeQuery(query);
            while (rs.next()) {
                String vendorId = rs.getString("Vendor_ID");
                String vendorCode = rs.getString("Vendor_Code");
                String vendorName = rs.getString("Vendor_Name");
                String contactPerson = rs.getString("Contact_Person");
                String contactAddress = rs.getString("Contact_Address");
                String vendorPhone = rs.getString("Vendor_Phone");
                String vendorFax = rs.getString("Vendor_fax");
                String vendorEmail = rs.getString("Vendor_email");
                String vendorState = rs.getString("Vendor_State");
                String aquisitionVendor = rs.getString("Acquisition_Vendor");
                String maintenanceVendor = rs.getString("Maintenance_Vendor");
                String accountNumber = rs.getString("account_number");
                String vendorStatus = rs.getString("Vendor_Status");
                String userId = rs.getString("User_ID");
                String createdate = sdf.format(rs.getDate("Create_date"));
                String accountType = rs.getString("account_type");
                String vendorProvince = rs.getString("vendor_province");
                vendor = new legend.admin.objects.Vendor();
                vendor.setVendorId(vendorId);
				vendor.setVendorCode(vendorCode);
				vendor.setVendorName(vendorName);
				vendor.setContactPerson(contactPerson);
				vendor.setContactAddress(contactAddress);
				vendor.setVendorPhone(vendorPhone);
				vendor.setVendorFax(vendorFax);
				vendor.setVendorEmail(vendorEmail);
				vendor.setVendorState(vendorState);
				vendor.setAquisitionVendor(aquisitionVendor);
				vendor.setMaintenanceVendor(maintenanceVendor);
				vendor.setAccountNumber(accountNumber);
				vendor.setVendorStatus(vendorStatus);
				vendor.setUserId(userId);
				vendor.setCreatedate(createdate);
				vendor.setAccountType(accountType);
				vendor.setVendorProvince(vendorProvince);
                
            }

        } catch (Exception e) {
            e.printStackTrace();
        }

        finally {
            closeConnection(c, s, rs);
        }
        return vendor;

    }


    private Connection getConnection() {
        Connection con = null;
        dc = new DataConnect("fixedasset");
        try {
            con = dc.getConnection();
        } catch (Exception e) {
            System.out.println("WARNING: Error getting connection ->" +
                               e.getMessage());
        }
        return con;
    }

    private void closeConnection(Connection con, Statement s) {
        try {
            if (s != null) {
                s.close();
            }
            if (con != null) {
                con.close();
            }
        } catch (Exception e) {
            System.out.println("WARNING: Error getting connection ->" +
                               e.getMessage());
        }

    }

    private void closeConnection(Connection con, PreparedStatement ps) {
        try {
            if (ps != null) {
                ps.close();
            }
            if (con != null) {
                con.close();
            }
        } catch (Exception e) {
            System.out.println("WARNING: Error closing connection ->" +
                               e.getMessage());
        }

    }

    /**
     *
     * @param con Connection
     * @param s Statement
     * @param rs ResultSet
     */
    private void closeConnection(Connection con, Statement s, ResultSet rs) {
        try {
            if (rs != null) {
                rs.close();
            }
            if (s != null) {
                s.close();
            }
            if (con != null) {
                con.close();
            }
        } catch (Exception e) {
            System.out.println("WARNING: Error closing connection ->" +
                               e.getMessage());
        }
    }

    /**
     *
     * @param con Connection
     * @param ps PreparedStatement
     * @param rs ResultSet
     */
    private void closeConnection(Connection con, PreparedStatement ps,
                                 ResultSet rs) {
        try {
            if (rs != null) {
                rs.close();
            }
            if (ps != null) {
                ps.close();
            }
            if (con != null) {
                con.close();
            }
        } catch (Exception e) {
            System.out.println("WARNING: Error closing connection ->" +
                               e.getMessage());
        }
    }

    private boolean executeQuery(String query) {
        Connection con = null;
        PreparedStatement ps = null;
        boolean done = false;
        try {
            con = getConnection();
            ps = con.prepareStatement(query);
            done = ps.execute();

        } catch (Exception e) {
            System.out.println("WARNING:Error executing Query ->" +
                               e.getMessage());
        } finally {
            closeConnection(con, ps);
        }
        return done;
    }


    public boolean createVendor(legend.admin.objects.Vendor vendor) {

        Connection con = null;
        PreparedStatement ps = null;
        boolean done = false;
        String query = "INSERT INTO am_ad_vendor"
                       + "(Vendor_Code,Vendor_Name"
                       + ",Contact_Person,Contact_Address"
                       + ",Vendor_Phone ,Vendor_fax,Vendor_email"
                       + ",Vendor_State ,Acquisition_Vendor,Maintenance_Vendor"
                       + ",account_number ,Vendor_Status,User_ID"
                       + ",Create_date ,account_type,vendor_province,Vendor_ID)"
                       + " VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";

        try {
            con = getConnection();
            ps = con.prepareStatement(query);
          
            ps.setString(1, vendor.getVendorCode());
            ps.setString(2, vendor.getVendorName());
            ps.setString(3, vendor.getContactPerson());
            ps.setString(4, vendor.getContactAddress());
            ps.setString(5, vendor.getVendorPhone());
            ps.setString(6, vendor.getVendorFax());
            ps.setString(7, vendor.getVendorEmail());
            ps.setString(8, vendor.getVendorState());
            ps.setString(9, vendor.getAquisitionVendor());
            ps.setString(10, vendor.getMaintenanceVendor());
            ps.setString(11, vendor.getAccountNumber());
            ps.setString(12, vendor.getVendorStatus());
            ps.setString(13, vendor.getUserId());
            ps.setDate(14, df.dateConvert(new java.util.Date()));
            ps.setString(15, vendor.getAccountType());
            ps.setString(16, vendor.getVendorProvince());
            ps.setLong(17, System.currentTimeMillis());
            done = (ps.executeUpdate()!=-1);

        } catch (Exception e) {
            System.out.println("WARNING:Error executing Query ->" +
                               e.getMessage());
        } finally {
            closeConnection(con, ps);
        }
        return done;

    }

    public java.util.ArrayList getVendorByStatus(String status){
    	String filter = " AND Vendor_Status='" + status + "'";
    	java.util.ArrayList _list = getVendorByQuery(filter);
    	return _list;    	
    } 
    public boolean updateVendor(legend.admin.objects.Vendor vendor) {

        Connection con = null;
        PreparedStatement ps = null;
        boolean done = false;

        String query = "UPDATE am_ad_vendor"
                       +" SET Vendor_Code = ?,Vendor_Name = ?"
                       +", Contact_Person = ?,Contact_Address = ?,Vendor_Phone = ?"
                       +" , Vendor_fax = ?,Vendor_email = ?,Vendor_State = ?"
                       +" , Acquisition_Vendor = ?,Maintenance_Vendor = ?,account_number = ?"
                       +" , Vendor_Status = ?"
                       +" , account_type = ?,vendor_province = ?"
                       +" WHERE Vendor_ID =?";

        try {
            con = getConnection();
            ps = con.prepareStatement(query);

			
            ps.setString(1, vendor.getVendorCode());
            ps.setString(2, vendor.getVendorName());
            ps.setString(3, vendor.getContactPerson());
            ps.setString(4, vendor.getContactAddress());
            ps.setString(5, vendor.getVendorPhone());
            ps.setString(6, vendor.getVendorFax());
            ps.setString(7, vendor.getVendorEmail());
            ps.setString(8, vendor.getVendorState());
            ps.setString(9, vendor.getAquisitionVendor());
            ps.setString(10, vendor.getMaintenanceVendor());
            ps.setString(11, vendor.getAccountNumber());
            ps.setString(12, vendor.getVendorStatus());
            ps.setString(13, vendor.getAccountType());
            ps.setString(14, vendor.getVendorProvince());
            ps.setString(15, vendor.getVendorId());
            done = (ps.executeUpdate()!=-1);

        } catch (Exception e) {
            System.out.println("WARNING:Error executing Query ->" +
                               e.getMessage());
        } finally {
            closeConnection(con, ps);
        }
        return done;

    }

    public boolean requireAccttype()  {
    	
    	
    	boolean flag = false;
    	try{
    		con = getConnection();
    		stmt = con.createStatement();
    	rs = stmt.executeQuery("select req_accttype from am_ad_legacy_sys_config");
        rs.next();
        flag = rs.getString(1).trim().equalsIgnoreCase("Y");
    	} 
    	catch(Exception ex){
    		System.out.println("Exception occurred while trying to retrieve requireAccttype ... " + ex.getMessage());    		
    	}
    	finally{
    		closeConnection(con,stmt,rs);
    	}
        return flag;
    }
}
